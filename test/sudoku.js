const DancingLinks = require('../dist/bundles/DancingLinks');

function initLocationDict(init_count) {
  var dic = [
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0]
  ];
  var s = [];
  var i, j, k, a, b, c, d;
  var count = 0;
  while (count < init_count) {
    i = Math.floor(Math.random() * 9);
    j = Math.floor(Math.random() * 9);
    k = Math.floor(Math.random() * 9) + 1;
    a = i * 9 + j;
    if (s.indexOf(a) !== -1) continue;
    b = i * 9 + k + 80;
    if (s.indexOf(b) !== -1) continue;
    c = j * 9 + k + 161;
    if (s.indexOf(c) !== -1) continue;
    d = (Math.floor(i / 3) * 3 + Math.floor(j / 3)) * 9 + k + 242;
    if (s.indexOf(d) !== -1) continue;
    s.push(a);
    s.push(b);
    s.push(c);
    s.push(d);
    dic[i][j] = k;
    count++;
  }
  return dic;
}

function generateDancingLinks(loc_dic) {
  var dancing_links = new DancingLinks();
  var i, j, k, a, b, c, d, row;
  for (i = 0; i < 9; i++) {
    for (j = 0; j < 9; j++) {
      if (loc_dic[i][j]) {
        k = loc_dic[i][j];
        a = i * 9 + j;
        b = i * 9 + k + 80;
        c = j * 9 + k + 161;
        d = (Math.floor(i / 3) * 3 + Math.floor(j / 3)) * 9 + k + 242;
        row = (i * 9 + j) * 9 + k - 1;
        dancing_links.addRow(row, [a, b, c, d]);
      } else {
        for (k = 1; k < 10; k++) {
          a = i * 9 + j;
          b = i * 9 + k + 80;
          c = j * 9 + k + 161;
          d = (Math.floor(i / 3) * 3 + Math.floor(j / 3)) * 9 + k + 242;
          row = (i * 9 + j) * 9 + k - 1;
          dancing_links.addRow(row, [a, b, c, d]);
        }
      }
    }
  }
  return dancing_links;
}

function formatSolution(solutions) {
  const arr = [];
  for (let i = 0; i < 9; i++) {
    arr.push(new Array(9));
  }
  for (let row of solutions) {
    let loc = Math.floor(row / 9);
    arr[Math.floor(loc / 9)][loc % 9] = row % 9 + 1
  }
  return arr;
}

function question(data, num) {
  var deletedNum = 0;
  var startTime = Date.now();
  var maxTime = 500;
  while (deletedNum < num) {
    if (Date.now() > startTime + maxTime) {
      return [];
    }
    const randomIndex = Math.floor(Math.random() * 81);
    const x = Math.floor(randomIndex / 9);
    const y = randomIndex % 9
    const temp = data[x][y];
    data[x][y] = 0;
    const dancing_links = generateDancingLinks(data);
    if (dancing_links.hasMultiSolution()) {
      data[x][y] = temp;
      deletedNum--;
      continue;
    }
    deletedNum++;
  }
  return data;
}

var levels = [
  {"level": 1, "data": [[0,8,0,3,0,6,0,1,0],[0,0,7,5,0,0,4,0,0],[0,0,9,7,0,0,0,0,0],[5,0,0,0,7,0,0,0,0],[0,0,1,0,6,0,7,0,0],[0,0,0,0,0,0,9,6,1],[0,5,0,0,0,7,0,3,0],[0,7,0,0,8,4,0,0,0],[1,4,0,0,5,0,0,0,2]]},
  {"level": 2, "data": [[0,0,5,8,1,6,0,0,0],[4,0,0,0,0,5,0,0,6],[0,0,2,0,0,0,5,0,1],[0,5,0,9,4,0,0,0,0],[2,0,0,0,0,0,0,7,0],[0,3,0,5,0,0,4,9,0],[0,0,3,0,0,0,7,5,0],[0,0,0,0,3,9,0,0,4],[1,8,0,0,0,0,0,0,0]]},
  {"level": 3, "data": [[6,7,0,8,4,0,0,0,0],[3,9,0,0,0,0,0,6,2],[0,0,8,6,0,9,0,3,0],[0,0,0,5,1,0,9,0,0],[1,0,0,7,0,0,0,0,8],[0,2,6,0,0,0,0,7,1],[0,3,0,0,0,0,0,0,9],[2,0,5,0,3,6,7,0,0],[0,0,0,0,5,7,2,0,0]]},
  {"level": 4, "data": [[5,0,0,6,9,0,0,0,4],[0,0,6,0,3,0,2,0,0],[2,0,8,0,0,0,0,0,3],[0,3,5,0,0,8,0,0,0],[4,0,0,9,0,0,0,0,5],[0,0,0,0,0,7,4,0,0],[3,0,0,2,0,0,0,0,1],[0,0,0,0,1,9,0,7,6],[0,9,0,0,0,0,0,2,0]]},
  {"level": 5, "data": [[0,0,3,0,0,0,0,1,5],[8,0,0,7,3,0,0,0,0],[2,0,9,0,0,8,0,0,0],[0,0,0,0,7,0,9,0,0],[6,0,2,0,0,0,3,0,0],[0,3,0,2,0,9,0,8,0],[0,0,0,0,4,0,7,0,2],[0,0,1,0,0,0,0,3,8],[5,2,0,3,0,0,0,0,0]]},
  {"level": 6, "data": [[0,5,0,0,0,4,0,6,0],[0,0,0,8,0,0,0,0,7],[0,0,6,5,0,0,0,0,4],[6,0,0,0,0,5,0,0,1],[8,0,0,0,3,0,0,0,0],[0,0,0,7,0,0,6,3,0],[0,0,2,0,1,6,4,0,0],[0,0,0,0,7,0,0,5,9],[0,1,4,0,5,0,7,0,0]]},
  {"level": 7, "data": [[0,8,2,0,0,6,5,0,0],[9,0,0,3,0,0,0,0,0],[0,5,0,0,0,0,0,9,6],[0,0,4,0,0,0,3,0,0],[0,0,8,5,0,0,9,0,4],[5,0,0,0,2,0,0,0,1],[0,4,0,0,0,8,0,1,0],[6,0,0,0,0,5,4,0,0],[0,0,0,7,0,0,0,6,9]]},
  {"level": 8, "data": [[2,0,0,0,0,9,0,0,6],[0,5,3,7,0,0,0,0,0],[0,0,0,0,8,2,7,0,0],[0,6,0,5,0,8,0,4,0],[0,8,0,9,0,0,2,0,0],[9,0,0,0,7,4,0,3,0],[1,0,0,2,0,0,0,0,0],[0,0,2,0,0,0,8,1,0],[0,0,0,0,4,0,0,0,2]]},
  {"level": 9, "data": [[8,0,0,0,0,0,0,5,0],[0,0,0,1,5,0,2,0,0],[1,0,0,0,0,0,0,3,0],[0,4,7,0,1,5,0,0,0],[0,0,6,2,0,0,5,0,0],[0,0,0,0,0,3,7,0,0],[4,9,0,0,7,0,0,6,0],[0,0,0,3,0,0,4,2,9],[0,6,8,0,2,0,0,0,0]]},
  {"level": 10, "data": [[4,3,0,0,0,0,0,1,9],[0,9,0,0,1,0,8,4,0],[0,0,0,0,9,0,0,0,5],[0,0,0,0,8,5,7,6,0],[0,0,3,0,0,7,0,0,0],[0,2,6,0,0,0,0,0,0],[6,0,2,0,0,0,0,0,0],[0,0,0,1,6,0,4,0,0],[0,0,4,5,0,0,0,8,6]]},
  {"level": 11, "data": [[5,8,0,4,0,0,0,0,0],[0,0,0,0,2,6,0,1,9],[0,6,0,0,0,0,0,4,3],[3,0,0,5,0,0,0,2,0],[0,0,0,0,8,4,7,0,0],[8,0,5,0,0,0,3,0,0],[0,0,0,6,7,1,0,0,0],[0,0,3,0,0,0,0,6,0],[0,0,6,0,0,0,4,0,2]]},
  {"level": 12, "data": [[9,0,0,0,4,0,0,0,2],[0,0,7,0,0,0,4,1,8],[4,0,2,1,0,0,0,0,0],[6,0,9,0,0,0,0,0,0],[0,0,1,0,5,2,0,3,0],[0,0,0,0,8,0,9,0,0],[7,2,0,0,0,0,0,0,3],[0,0,0,2,0,0,1,0,4],[0,6,0,7,0,4,0,0,0]]},
  {"level": 13, "data": [[0,3,0,1,0,0,7,0,0],[0,0,0,0,0,2,3,9,0],[0,7,2,4,0,9,0,0,0],[5,0,0,0,0,0,0,8,0],[0,0,7,0,1,6,0,0,0],[8,1,0,0,0,0,2,0,0],[0,0,0,0,5,8,0,0,9],[0,0,5,0,0,0,0,0,6],[0,2,9,6,0,0,0,5,0]]},
  {"level": 14, "data": [[0,0,3,6,0,0,0,1,0],[1,0,0,0,0,7,0,0,0],[0,0,6,0,0,5,7,0,4],[0,4,7,0,0,0,9,0,0],[0,0,0,0,6,3,0,0,0],[0,0,0,1,0,0,0,8,5],[2,0,0,0,3,6,0,5,0],[0,3,9,0,0,0,0,0,6],[0,0,0,2,5,0,8,0,0]]},
  {"level": 15, "data": [[0,0,4,7,3,0,0,0,0],[0,0,0,0,1,0,0,3,6],[0,1,3,0,0,0,4,0,0],[0,0,8,0,2,6,0,0,0],[0,9,0,3,0,7,0,6,1],[0,0,0,9,0,0,0,0,7],[2,0,0,4,0,0,0,1,0],[9,0,0,0,0,8,0,0,0],[6,0,0,0,0,0,2,4,0]]},
  {"level": 16, "data": [[3,0,0,5,0,0,0,0,2],[4,0,0,0,6,0,0,7,0],[0,0,7,0,0,4,0,0,8],[0,8,0,0,0,1,0,0,7],[0,3,0,6,0,0,4,0,0],[9,0,0,0,0,5,8,0,0],[0,0,0,0,0,0,2,8,0],[0,1,9,4,8,0,0,0,0],[0,0,0,0,3,0,0,1,9]]},
  {"level": 17, "data": [[0,4,1,3,0,0,0,0,0],[0,0,0,8,2,0,0,4,0],[2,0,0,0,0,0,6,0,7],[5,2,9,0,0,0,0,0,0],[0,0,0,0,0,2,3,0,0],[0,0,0,0,0,9,4,7,2],[3,5,0,0,0,0,0,2,0],[0,0,0,0,7,0,1,0,8],[7,0,6,2,0,0,0,0,0]]},
  {"level": 18, "data": [[0,9,0,2,0,0,0,0,0],[0,5,0,0,0,0,0,7,0],[4,0,0,6,0,8,0,3,0],[0,0,5,0,2,6,4,0,0],[6,0,3,0,0,0,0,2,5],[0,0,0,3,5,0,1,0,0],[0,0,8,0,0,2,0,0,0],[1,0,0,8,0,0,0,0,6],[0,0,0,0,0,4,3,0,8]]},
  {"level": 19, "data": [[0,0,0,9,0,0,4,0,1],[0,0,0,1,7,4,0,0,0],[7,0,0,0,0,0,0,3,0],[4,0,0,0,0,1,0,0,7],[0,5,7,2,0,0,0,0,0],[8,0,0,0,3,0,0,9,0],[0,2,0,0,1,9,0,0,0],[0,6,0,0,4,0,0,8,0],[0,7,0,0,0,5,6,0,9]]},
  {"level": 20, "data": [[0,0,4,0,7,6,0,0,0],[7,0,0,0,0,0,0,8,0],[0,0,0,4,0,0,6,2,0],[0,5,0,0,6,0,0,4,0],[3,0,0,0,0,4,0,9,1],[4,0,8,5,0,0,7,0,0],[0,9,0,0,0,5,0,0,0],[0,1,5,0,0,0,0,0,9],[0,0,0,6,0,0,8,1,0]]},
  {"level": 21, "data": [[0,2,6,8,0,0,0,1,0],[1,0,0,2,6,0,0,0,0],[0,0,0,0,0,0,0,6,9],[0,0,5,0,4,7,0,0,0],[4,0,1,0,0,0,0,0,8],[0,0,0,0,8,0,4,7,0],[0,0,2,0,5,8,0,0,0],[3,0,0,0,0,4,0,0,2],[0,0,0,6,0,0,8,0,5]]},
  {"level": 22, "data": [[0,0,0,0,0,7,0,2,0],[0,0,0,5,8,2,0,9,0],[0,4,8,0,0,0,5,0,0],[4,0,0,0,0,9,0,0,6],[0,0,6,0,1,0,4,0,0],[0,0,9,2,6,0,0,0,0],[0,6,0,0,7,0,0,0,5],[3,9,0,0,0,0,0,6,0],[5,0,7,0,0,3,0,0,0]]},
  {"level": 23, "data": [[0,0,0,2,5,0,0,0,0],[9,0,0,0,3,0,0,0,7],[0,2,8,0,0,1,0,9,0],[0,0,7,4,0,2,0,0,8],[0,4,0,5,0,0,0,6,2],[0,9,0,0,0,8,1,0,0],[0,0,0,0,0,0,6,0,0],[1,0,0,0,0,0,0,2,5],[7,0,2,0,0,6,0,0,0]]},
  {"level": 24, "data": [[5,0,0,4,1,7,0,0,0],[0,6,0,0,0,0,0,0,7],[0,0,4,0,0,0,0,0,5],[0,1,5,2,0,0,0,0,0],[0,0,7,0,3,0,6,0,0],[0,0,0,0,4,0,2,0,9],[4,9,0,0,0,0,5,0,0],[0,2,0,1,0,8,0,4,0],[3,0,0,9,0,0,0,7,0]]},
  {"level": 25, "data": [[0,0,6,9,0,0,0,0,0],[0,1,0,2,0,7,0,0,3],[0,5,0,0,0,0,1,6,7],[0,0,3,0,0,0,6,0,8],[1,0,0,0,3,0,0,0,2],[0,0,8,1,0,0,0,0,0],[0,0,0,0,7,1,0,0,0],[6,3,0,0,2,0,0,5,0],[0,0,0,0,5,0,2,8,0]]},
  {"level": 26, "data": [[0,0,8,0,0,2,0,6,5],[0,0,0,0,0,0,4,0,7],[0,0,6,0,4,0,0,0,0],[0,0,0,0,1,5,2,4,0],[4,0,9,2,0,0,0,0,0],[0,7,0,0,0,3,0,1,0],[1,0,0,0,0,7,0,0,2],[0,5,0,0,8,0,7,0,0],[6,0,0,9,0,0,0,5,0]]},
  {"level": 27, "data": [[0,6,0,0,3,0,0,5,0],[3,0,0,5,0,0,0,1,7],[0,2,7,0,0,9,3,0,0],[1,0,0,0,9,0,0,7,0],[6,0,0,0,0,0,0,0,9],[0,0,5,6,0,0,0,4,0],[4,8,3,0,0,0,0,0,0],[0,0,0,0,0,8,7,0,3],[0,1,0,9,0,0,0,0,0]]},
  {"level": 28, "data": [[0,0,0,5,0,3,0,0,2],[0,0,0,0,1,0,0,3,0],[8,0,3,0,0,7,0,0,5],[0,0,0,3,0,6,0,0,0],[0,0,0,0,0,8,5,1,0],[4,2,8,0,0,0,0,0,0],[1,6,0,0,4,0,0,5,0],[0,3,0,0,8,0,9,0,0],[0,8,2,6,0,0,0,0,0]]},
  {"level": 29, "data": [[0,9,1,6,0,2,0,0,0],[0,3,0,0,0,0,8,0,2],[0,6,0,7,3,0,0,0,9],[0,0,5,0,0,6,0,4,0],[0,0,0,2,0,0,7,0,0],[0,0,2,0,7,0,0,9,0],[0,5,0,0,0,7,1,0,0],[1,0,0,0,9,5,0,0,0],[4,0,0,0,0,0,0,0,3]]},
  {"level": 30, "data": [[8,0,0,7,0,0,3,0,9],[3,0,7,0,0,0,0,0,4],[0,0,0,6,8,0,0,0,0],[0,5,0,8,0,6,0,0,0],[0,0,9,0,4,0,0,5,0],[0,0,0,0,0,0,7,0,6],[0,4,0,0,3,5,0,2,0],[5,0,0,0,0,0,9,4,0],[0,0,6,0,0,2,0,8,0]]},
  {"level": 31, "data": [[6,0,0,0,0,0,2,0,4],[0,0,0,6,9,0,0,0,0],[0,0,9,0,0,8,7,0,0],[0,7,6,0,0,0,0,4,0],[9,0,0,0,0,0,0,7,5],[0,1,0,3,0,4,0,0,0],[0,0,5,0,0,7,1,0,0],[7,3,0,1,8,0,0,0,0],[0,6,0,0,5,0,0,0,7]]},
  {"level": 32, "data": [[7,0,0,0,4,0,0,9,0],[0,0,0,0,0,0,5,2,0],[6,0,9,7,1,0,0,0,0],[0,6,2,0,0,0,9,0,4],[0,0,0,0,8,2,0,0,1],[4,0,0,3,0,0,0,0,0],[0,0,0,0,0,7,0,5,8],[2,7,0,0,0,0,0,0,0],[0,3,0,1,0,4,6,0,0]]},
  {"level": 33, "data": [[7,3,0,0,2,0,4,0,0],[0,0,2,6,0,1,8,0,0],[0,0,0,0,0,9,0,0,6],[8,0,5,0,0,0,0,9,0],[0,0,0,9,0,4,0,0,0],[3,0,0,0,0,2,7,0,0],[0,8,0,0,9,0,0,0,7],[9,0,0,0,5,0,0,8,2],[0,0,0,4,0,0,0,3,0]]},
  {"level": 34, "data": [[0,0,6,0,1,0,0,0,0],[3,0,8,0,0,6,0,2,0],[5,0,0,2,0,0,0,0,7],[0,5,0,0,0,1,7,0,0],[0,0,9,7,0,0,5,3,0],[2,0,0,0,0,0,0,0,6],[4,0,0,0,6,0,8,0,0],[0,6,2,0,0,5,0,0,3],[0,0,0,4,0,0,0,0,9]]},
  {"level": 35, "data": [[0,3,0,0,0,4,0,0,2],[2,9,0,0,8,0,0,7,0],[0,0,1,7,0,0,6,0,0],[0,0,0,0,0,2,4,0,0],[0,0,0,8,3,0,0,1,0],[5,8,3,0,0,0,0,0,0],[0,0,0,2,5,7,0,0,0],[4,0,0,0,0,0,7,0,0],[3,7,0,0,9,0,0,0,8]]},
  {"level": 36, "data": [[0,7,1,2,0,5,0,9,0],[0,0,5,7,0,0,8,0,2],[0,4,0,0,3,0,0,1,7],[0,0,0,0,0,7,0,0,0],[4,9,0,0,0,3,0,0,0],[3,0,0,0,0,0,2,0,8],[0,0,0,5,0,2,0,0,3],[0,0,0,0,0,0,0,5,9],[0,0,3,0,1,0,0,0,0]]},
  {"level": 37, "data": [[0,0,7,8,0,0,2,0,0],[0,0,1,0,2,0,0,0,7],[5,9,0,0,4,0,0,0,0],[0,0,6,9,5,0,7,0,0],[3,0,0,0,0,0,0,2,0],[0,0,0,0,0,8,1,9,0],[0,1,0,2,0,0,0,0,4],[0,7,0,0,0,3,0,0,0],[0,0,0,7,0,4,6,8,0]]},
  {"level": 38, "data": [[0,0,8,0,0,1,3,0,0],[0,0,5,4,0,8,0,0,6],[0,0,3,0,0,0,0,0,1],[3,0,0,0,1,0,0,6,2],[0,1,0,0,0,0,5,0,0],[9,0,0,6,0,0,0,0,0],[2,7,0,9,0,0,0,0,5],[0,3,0,0,8,0,0,7,0],[0,0,1,0,2,7,0,0,0]]},
  {"level": 39, "data": [[0,0,5,7,4,0,0,0,0],[0,7,0,0,0,0,0,5,8],[0,6,0,5,0,0,0,0,2],[2,0,0,0,6,9,5,0,0],[0,8,0,0,0,3,2,0,9],[0,0,6,8,0,0,0,0,4],[1,0,0,0,3,0,0,0,0],[0,9,0,0,0,0,0,4,0],[0,0,0,6,0,1,3,0,0]]},
  {"level": 40, "data": [[0,3,0,0,0,0,0,0,0],[0,0,5,0,0,2,0,4,0],[0,0,2,0,3,0,6,0,1],[3,0,0,0,1,0,0,0,2],[0,5,0,2,0,0,0,3,0],[4,0,0,0,0,0,1,6,0],[9,0,0,7,0,1,0,0,8],[0,1,0,3,0,0,2,0,0],[0,0,4,0,9,0,7,0,0]]}
];
for(var n = 0 ; n < levels.length; n++) {
  var dancing_links = generateDancingLinks(levels[n].data);
  var solution = dancing_links.solveOne();
  if (!solution.length) {
    console.log(levels[n].level);
    continue;
  }
}
// for (var n = 1; n <= 60; n++) {
//   var loc_dic = initLocationDict(11);
//   var dancing_links = generateDancingLinks(loc_dic);
//   var solution = dancing_links.solveOne();
//   if (!solution.length) {
//     n--;
//     continue;
//   }
//   var que = question(formatSolution(solution), n);
//   if (!que.length) {
//     n--;
//     continue;
//   }
//   var str = que.reduce((cal, q, idx) => {
//     const str = q.reduce((c, n, i) => {
//       return `${c}${i === 0 ? '' : ','}${n}`
//     }, '')
//     return `${cal}${idx === 0 ? '' : ','}[${str}]`;
//   }, '')
//   console.log(`{"level": ${n+1}, "data": [${str}]}`);
// }
